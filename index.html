<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç­çº§ç§¯åˆ†ä¹å›­ ğŸŒ±</title>
    <style>
        /* é€šç”¨æ ·å¼ */
        body {
            font-family: "Segoe UI", "Roboto", "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
            transition: background-color 0.4s;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        /* å¤´éƒ¨æ ·å¼ */
        header {
            text-align: center;
            margin-bottom: 40px;
        }

        h1 {
            font-size: 32px;
            color: #4CAF50;
            font-weight: 300;
        }

        /* æ§åˆ¶æ æ ·å¼ */
        .control-bar {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 15px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .control-bar input,
        .control-bar select,
        .control-bar button {
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 5px;
            flex: 1;
            min-width: 200px;
        }

        .control-bar button {
            background-color: #4CAF50;
            color: #fff;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .control-bar button:hover {
            background-color: #45a049;
        }

        /* åˆ—è¡¨æ ·å¼ */
        .student-list,
        .group-list {
            padding: 20px;
            background-color: #fff;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .student-list .student-item,
        .group-list .group-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin: 5px 0;
            background-color: #f9f9f9;
            border-radius: 5px;
            transition: background-color 0.3s;
        }

        .student-list .student-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .student-list .student-header input[type="checkbox"] {
            margin-right: 5px;
        }

        .student-list .student-item:hover,
        .group-list .group-item:hover {
            background-color: #e0f2f1;
        }

        /* è¡¨æ ¼æ ·å¼ */
        .ranking-table {
            width: 100%;
            margin-bottom: 20px;
            border-collapse: collapse;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .ranking-table th,
        .ranking-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .ranking-table th {
            background-color: #4CAF50;
            color: #fff;
            text-transform: uppercase;
        }

        /* æœç´¢æ ·å¼ */
        .search-bar {
            margin-bottom: 20px;
            display: flex;
            justify-content: flex-start;
            align-items: center;
            gap: 10px;
        }

        .search-bar input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            width: 300px;
        }

        .search-bar button {
            padding: 10px 20px;
            background-color: #2196F3;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .search-bar button:hover {
            background-color: #1976D2;
        }

        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            width: 300px;
            text-align: center;
        }

        .modal-content input {
            width: 100%;
            padding: 8px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .modal-content button {
            padding: 8px 16px;
            background-color: #4CAF50;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .control-bar {
                flex-direction: column;
            }

            .control-bar input,
            .control-bar select,
            .control-bar button {
                margin: 5px 0;
                width: 100%;
            }

            .ranking-table th,
            .ranking-table td {
                padding: 8px;
                font-size: 14px;
            }
        }

        /* è‡ªå®šä¹‰æŒ‰é’®æ ·å¼ */
        .score-button {
            padding: 5px;
            border: none;
            border-radius: 5px;
            color: #fff;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .score-button.add {
            background-color: #4CAF50;
        }

        .score-button.add:hover {
            background-color: #45a049;
        }

        .score-button.subtract {
            background-color: #f44336;
        }

        .score-button.subtract:hover {
            background-color: #e53935;
        }

        .edit-button {
            background-color: #2196F3;
        }

        .edit-button:hover {
            background-color: #1976D2;
        }
    </style>
</head>
<body>
    <header>
        <h1>ç­çº§ç§¯åˆ†ä¹å›­ ğŸŒ±</h1>
    </header>
    <div class="container">
        <!-- æ§åˆ¶æ  -->
        <div class="control-bar">
            <!-- ç­çº§é€‰æ‹© -->
            <div>
                <label for="classSelect">é€‰æ‹©ç­çº§:</label>
                <select id="classSelect" onchange="switchClass()">
                    <option value="">è¯·é€‰æ‹©ç­çº§</option>
                </select>
                <button onclick="openAddClassModal()">æ·»åŠ ç­çº§</button>
                <button onclick="deleteClass()">åˆ é™¤ç­çº§</button>
                <button onclick="openEditClassModal()">ç¼–è¾‘ç­çº§</button>
            </div>

            <!-- æ‰¹é‡å¯¼å…¥éƒ¨åˆ† -->
            <div>
                <h3>æ‰¹é‡å¯¼å…¥å­¦ç”Ÿåå•</h3>
                <textarea class="import-textarea" id="importInput" placeholder="ğŸ‰ æ‰¹é‡å¯¼å…¥å­¦ç”Ÿï¼ˆæ¯è¡Œæ ¼å¼ï¼šç»„åˆ«,å­¦å·,å§“åï¼‰"></textarea>
                <button onclick="importStudents()">ğŸš€ å¯¼å…¥</button>
            </div>

            <!-- å…¶ä»–æ“ä½œ -->
            <div>
                <select id="groupFilter" onchange="filterStudents()">
                    <option value="">ğŸ‰ æ‰€æœ‰ç»„åˆ«</option>
                </select>
                <input type="text" id="searchInput" placeholder="ğŸ” æœç´¢å­¦ç”Ÿï¼ˆå§“åã€å­¦å·ç­‰ï¼‰" oninput="searchStudent()">
                <button onclick="searchStudent()">ğŸ”</button>
            </div>
        </div>

        <!-- å­¦ç”Ÿåˆ—è¡¨ -->
        <div class="student-list" id="studentList">
            <!-- å…¨é€‰æŒ‰é’® -->
            <div class="student-header">
                <input type="checkbox" id="selectAll" onchange="handleSelectAll()">
                <label for="selectAll">å…¨é€‰/å…¨ä¸é€‰</label>
                <button onclick="batchDelete()">ğŸ—‘ï¸ æ‰¹é‡åˆ é™¤</button>
            </div>
            <!-- å­¦ç”Ÿä¿¡æ¯åŠ¨æ€åŠ è½½ -->
        </div>

        <!-- å°ç»„åˆ—è¡¨ -->
        <div class="group-list" id="groupList">
            <!-- å°ç»„ä¿¡æ¯åŠ¨æ€åŠ è½½ -->
        </div>

        <!-- æ’è¡Œæ¦œåŒºåŸŸ -->
        <div class="ranking-container">
            <button onclick="showPersonalRanking()">ğŸŒŸ ä¸ªäººæ’è¡Œæ¦œ</button>
            <button onclick="showGroupRanking()">ğŸŒŸ å°ç»„æ’è¡Œæ¦œ</button>
            <button onclick="exportRanking()">ğŸ“„ å¯¼å‡ºæ’è¡Œæ¦œ</button>
            <table class="ranking-table" id="rankingTable">
                <thead>
                    <tr>
                        <th>æ’å</th>
                        <th>å§“å/ç»„åˆ«</th>
                        <th>ç§¯ åˆ†</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <!-- æ·»åŠ ç­çº§æ¨¡æ€æ¡† -->
    <div id="addClassModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAddClassModal()">&times;</span>
            <h2>æ·»åŠ æ–°ç­çº§ âœ¨</h2>
            <input type="text" id="newClassName" placeholder="è¯·è¾“å…¥ç­çº§åç§°">
            <button type="button" onclick="addClass()">âœ¨ æ·»åŠ ç­çº§</button>
        </div>
    </div>

    <!-- ç¼–è¾‘ç­çº§æ¨¡æ€æ¡† -->
    <div id="editClassModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEditClassModal()">&times;</span>
            <h2>ç¼–è¾‘ç­çº§åç§° âœ¨</h2>
            <input type="text" id="editClassName" placeholder="è¯·è¾“å…¥æ–°çš„ç­çº§åç§°">
            <button type="button" onclick="saveClassEdit()">âœ¨ ä¿å­˜</button>
        </div>
    </div>

    <!-- è„šæ³¨ -->
    <footer>
        <p>ğŸŒ± ç‰ˆæƒæ‰€æœ‰</p>
    </footer>

    <script>
        // æ•°æ®å­˜å‚¨
        let classData = {}; // æŒ‰ç­çº§å­˜å‚¨æ•°æ®
        let currentClass = ''; // å½“å‰é€‰æ‹©çš„ç­çº§

        // åˆå§‹åŒ–é¡µé¢
        function init() {
            const savedData = JSON.parse(localStorage.getItem('classData'));
            classData = savedData ? savedData : {};
            updateClassSelect();
            switchClass(); // åˆå§‹åŒ–æ—¶ä½¿ç”¨ç¬¬ä¸€ä¸ªç­çº§
        }

        // æ›´æ–°ç­çº§é€‰æ‹©ä¸‹æ‹‰æ¡†
        function updateClassSelect() {
            const classSelect = document.getElementById('classSelect');
            classSelect.innerHTML = '<option value="">è¯·é€‰æ‹©ç­çº§</option>';
            for (const className in classData) {
                const option = document.createElement('option');
                option.value = className;
                option.textContent = className;
                classSelect.appendChild(option);
            }
        }

        // åˆ‡æ¢ç­çº§
        function switchClass() {
            const classSelect = document.getElementById('classSelect');
            currentClass = classSelect.value;

            if (!currentClass) return;

            updateStudents();
            updateGroups();
            updateFilters();
        }

        // æ·»åŠ ç­çº§
        function openAddClassModal() {
            document.getElementById('addClassModal').style.display = 'flex';
        }

        function closeAddClassModal() {
            document.getElementById('addClassModal').style.display = 'none';
        }

        function addClass() {
            const newClassName = document.getElementById('newClassName').value.trim();
            if (newClassName && !classData[newClassName]) {
                classData[newClassName] = { students: [] }; // åˆ›å»ºæ–°ç­çº§å¹¶åˆå§‹åŒ–å­¦ç”Ÿæ•°æ®
                saveClassData();
                updateClassSelect();
                closeAddClassModal();
                alert('ç­çº§æ·»åŠ æˆåŠŸ');
            } else {
                alert('ç­çº§åç§°ä¸èƒ½ä¸ºç©ºæˆ–å·²å­˜åœ¨');
            }
        }

        // åˆ é™¤ç­çº§
        function deleteClass() {
            if (!currentClass) {
                alert('è¯·é€‰æ‹©è¦åˆ é™¤çš„ç­çº§');
                return;
            }

            const confirmation = confirm(`ç¡®è®¤åˆ é™¤ç­çº§ "${currentClass}" åŠå…¶æ‰€æœ‰æ•°æ®å—ï¼Ÿ`);
            if (confirmation) {
                delete classData[currentClass];
                if (currentClass === '' && Object.keys(classData).length > 0) {
                    currentClass = Object.keys(classData)[0]; // å°†å½“å‰ç­çº§åˆ‡æ¢ä¸ºç¬¬ä¸€ä¸ªç­çº§
                }
                saveClassData();
                updateClassSelect();
                alert('ç­çº§å·²åˆ é™¤');
                updateStudents();
                updateGroups();
            }
        }

        // æ‰“å¼€ç¼–è¾‘ç­çº§æ¨¡æ€æ¡†
        function openEditClassModal() {
            if (!currentClass) {
                alert('è¯·é€‰æ‹©è¦ç¼–è¾‘çš„ç­çº§');
                return;
            }

            document.getElementById('editClassName').value = currentClass;
            document.getElementById('editClassModal').style.display = 'flex';
        }

        function closeEditClassModal() {
            document.getElementById('editClassModal').style.display = 'none';
        }

        function saveClassEdit() {
            const newClassName = document.getElementById('editClassName').value.trim();
            if (newClassName && !classData[newClassName]) {
                classData[newClassName] = classData[currentClass]; // ç§»åŠ¨å­¦ç”Ÿæ•°æ®åˆ°æ–°ç­çº§
                delete classData[currentClass]; // åˆ é™¤æ—§ç­çº§
                currentClass = newClassName; // æ›´æ–°å½“å‰ç­çº§
                saveClassData();
                updateClassSelect();
                closeEditClassModal();
                alert('ç­çº§åç§°å·²æ›´æ–°');
                switchClass();
            } else {
                alert('ç­çº§åç§°ä¸èƒ½ä¸ºç©ºæˆ–å·²å­˜åœ¨');
            }
        }

        // æ›´æ–°å°ç»„åˆ—è¡¨
        function updateGroups() {
            const groups = getCurrentGroups();
            const groupList = document.getElementById('groupList');
            groupList.innerHTML = groups.map(group => `
                <div class="group-item">
                    <span>${group.name}ï¼ˆæ€»åˆ†ï¼š${group.totalScore}ï¼‰</span>
                    <button onclick="deleteGroup('${group.id}')">ğŸ—‘ï¸ åˆ é™¤</button>
                </div>
            `).join('');
        }

        // è·å–å½“å‰ç­çº§çš„å­¦ç”Ÿ
        function getCurrentStudents() {
            return classData[currentClass]?.students || [];
        }

        // è·å–å½“å‰ç­çº§çš„å°ç»„
        function getCurrentGroups() {
            const students = getCurrentStudents();
            return students.reduce((acc, student) => {
                const group = student.group || 'æœªåˆ†ç»„';
                const groupEntry = acc.find(g => g.id === group);
                if (groupEntry) {
                    groupEntry.totalScore += student.score || 0;
                } else {
                    acc.push({
                        id: group,
                        name: group === 'æœªåˆ†ç»„' ? 'æœªåˆ†ç»„' : `å°ç»„ ${group}`,
                        totalScore: (student.score || 0)
                    });
                }
                return acc;
            }, []);
        }

        // æ›´æ–°å­¦ç”Ÿåˆ—è¡¨
        function updateStudents(filter = '') {
            const students = getCurrentStudents();
            const filteredStudents = filter ? students.filter(student => 
                student.name.includes(filter) || student.id.includes(filter)
            ) : students;

            const studentList = document.getElementById('studentList');
            studentList.innerHTML = `
                <div class="student-header">
                    <input type="checkbox" id="selectAll" onchange="handleSelectAll()">
                    <label for="selectAll">å…¨é€‰/å…¨ä¸é€‰</label>
                    <button onclick="batchDelete()">ğŸ—‘ï¸ æ‰¹é‡åˆ é™¤</button>
                </div>
                ${filteredStudents.map(student => `
                    <div class="student-item">
                        <input type="checkbox" class="select-student" data-student-id="${student.id}">
                        <span>ID: ${student.id}</span>
                        <span>å§“å: ${student.name}</span>
                        <span>ç»„åˆ«: ${student.group}</span>
                        <input type="number" value="${student.score || 0}" onchange="editScore('${student.id}', this.value)" style="width: 60px; margin-left: 10px;">
                        <button class="score-button add" onclick="changeScore('${student.id}', 1)">â•</button>
                        <button class="score-button subtract" onclick="changeScore('${student.id}', -1)">â–</button>
                        <button onclick="deleteStudent('${student.id}')">ğŸ—‘ï¸ åˆ é™¤</button>
                    </div>
                `).join('')}
            `;
        }

        // æ‰¹é‡å¯¼å…¥å­¦ç”Ÿä¿¡æ¯
        function importStudents() {
            const importInput = document.getElementById('importInput').value.trim();
            if (!importInput) {
                alert('è¯·è¾“å…¥æ‰¹é‡å¯¼å…¥çš„å­¦ç”Ÿåå•');
                return;
            }

            const lines = importInput.split('\n');
            const newStudents = lines.map(line => {
                const [group, id, name] = line.split(',');
                return {
                    id: id.trim(),
                    name: name.trim(),
                    group: group ? group.trim() : 'æœªåˆ†ç»„',
                    score: 0
                };
            }).filter(student => student.id && student.name);

            if (newStudents.length === 0) {
                alert('æœªæ£€æµ‹åˆ°æœ‰æ•ˆæ•°æ®ï¼Œè¯·æ£€æŸ¥æ ¼å¼');
                return;
            }

            const students = getCurrentStudents();
            classData[currentClass] = { students: [...students, ...newStudents] };
            saveClassData();
            alert('ğŸ‰ å­¦ç”Ÿåå•å¯¼å…¥æˆåŠŸ');
            updateStudents();
            updateGroups();
            updateFilters();
        }

        // æ›´æ–°å°ç»„ç­›é€‰å™¨
        function updateFilters() {
            const groupFilter = document.getElementById('groupFilter');
            groupFilter.innerHTML = '<option value="">ğŸ‰ æ‰€æœ‰ç»„åˆ«</option>';

            const uniqueGroups = [...new Set(getCurrentStudents().map(student => student.group))];
            uniqueGroups.forEach(group => {
                const option = document.createElement('option');
                option.value = group;
                option.textContent = group === 'æœªåˆ†ç»„' ? 'æœªåˆ†ç»„' : `å°ç»„ ${group}`;
                groupFilter.appendChild(option);
            });
        }

        // è¿‡æ»¤å­¦ç”Ÿ
        function filterStudents() {
            const filter = document.getElementById('groupFilter').value;
            updateStudents(filter);
        }

        // æœç´¢å­¦ç”Ÿ
        function searchStudent() {
            const searchValue = document.getElementById('searchInput').value.trim();
            updateStudents(searchValue);
        }

        // æ”¹å˜ç§¯åˆ†ï¼Œç®€åŒ–é€»è¾‘å»æ‰ç¡®è®¤å¼¹æ¡†
        function changeScore(studentId, change) {
            const students = getCurrentStudents();
            const student = students.find(s => s.id === studentId);
            if (student) {
                student.score += change;
                saveClassData();
                updateStudents();
                updateGroups();
                updateFilters();
            }
        }

        // ç¼–è¾‘åˆ†æ•°
        function editScore(studentId, newScore) {
            const students = getCurrentStudents();
            const student = students.find(s => s.id === studentId);
            if (student) {
                student.score = parseInt(newScore, 10) || 0;
                saveClassData();
                updateStudents();
                updateGroups();
                updateFilters();
            }
        }

        // åˆ é™¤å­¦ç”Ÿ
        function deleteStudent(studentId) {
            const students = getCurrentStudents();
            const index = students.findIndex(s => s.id === studentId);
            if (index !== -1) {
                students.splice(index, 1);
                saveClassData();
                alert('å­¦ç”Ÿå·²ç§»é™¤');
                updateStudents();
                updateGroups();
                updateFilters();
            }
        }

        // åˆ é™¤å°ç»„
        function deleteGroup(groupId) {
            const students = getCurrentStudents();
            classData[currentClass].students = students.filter(student => student.group !== groupId);
            saveClassData();
            alert('å°ç»„å·²ç§»é™¤');
            updateStudents();
            updateGroups();
            updateFilters();
        }

        // æ˜¾ç¤ºä¸ªäººæ’è¡Œæ¦œ
        function showPersonalRanking() {
            const rankingTable = document.getElementById('rankingTable');
            const tbody = rankingTable.querySelector('tbody');
            const sortedStudents = [...getCurrentStudents()].sort((a, b) => (b.score || 0) - (a.score || 0));

            tbody.innerHTML = sortedStudents.map((student, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td>${student.name}</td>
                    <td>${student.score || 0}</td>
                </tr>
            `).join('');
        }

        // æ˜¾ç¤ºå°ç»„æ’è¡Œæ¦œ
        function showGroupRanking() {
            const rankingTable = document.getElementById('rankingTable');
            const tbody = rankingTable.querySelector('tbody');
            const sortedGroups = [...getCurrentGroups()].sort((a, b) => b.totalScore - a.totalScore);

            tbody.innerHTML = sortedGroups.map((group, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td>${group.name}</td>
                    <td>${group.totalScore}</td>
                </tr>
            `).join('');
        }

        // å¯¼å‡ºæ’è¡Œæ¦œä¸ºCSV
        function exportRanking() {
            const rankingTable = document.getElementById('rankingTable');
            const rows = Array.from(rankingTable.querySelectorAll('tr'));
            const csvContent = rows.map(row => {
                const cols = Array.from(row.querySelectorAll('th, td'));
                return cols.map(col => col.textContent).join(',');
            }).join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'æ’è¡Œæ¦œ.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // ä¿å­˜ç­çº§æ•°æ®åˆ° localStorage
        function saveClassData() {
            localStorage.setItem('classData', JSON.stringify(classData, null, 2));
        }

        // å…¨é€‰åŠŸèƒ½
        function handleSelectAll() {
            const selectAllCheckbox = document.getElementById('selectAll');
            const studentItems = document.querySelectorAll('.student-item input[type="checkbox"]');

            studentItems.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
            });
        }

        // æ‰¹é‡åˆ é™¤åŠŸèƒ½
        function batchDelete() {
            const selectedCheckboxes = document.querySelectorAll('.student-item input[type="checkbox"]:checked');
            const selectedIds = Array.from(selectedCheckboxes).map(checkbox => checkbox.dataset.studentId);

            if (selectedIds.length === 0) {
                alert('è¯·é€‰æ‹©è¦åˆ é™¤çš„å­¦ç”Ÿ');
                return;
            }

            const confirmation = confirm(`ç¡®è®¤åˆ é™¤ ${selectedIds.length} ä½å­¦ç”Ÿï¼Ÿ`);
            if (confirmation) {
                const students = getCurrentStudents();
                classData[currentClass].students = students.filter(student => !selectedIds.includes(student.id));
                saveClassData();
                alert('å­¦ç”Ÿå·²æ‰¹é‡åˆ é™¤');
                updateStudents();
                updateGroups();
                updateFilters();
            }
        }

        // åˆå§‹åŒ–é¡µé¢
        init();
    </script>
</body>
</html>